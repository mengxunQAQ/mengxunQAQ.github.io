---
layout:     post
title:     Django的任意重定向漏洞
subtitle:   利用Django的URL跳转钓鱼
date:       2025-11-30
author:     mengxun
header-img: img/bg/blue-raw.png
catalog: true
tags:
    - 安全
---


#### 0x01 漏洞背景

在2018年，[Django框架](https://www.djangoproject.com/weblog/2018/aug/01/security-releases/)发布了`2.0.8`版本，修复了一个任意重定向漏洞（[CVE-2018-14574](https://nvd.nist.gov/vuln/detail/CVE-2018-14574)）。


#### 0x02 背后原因

这个重定向漏洞源头来自于 `Django` 的 [APPEND_SLASH](https://docs.djangoproject.com/en/dev/ref/settings/#std-setting-APPEND_SLASH) 配置项。

在问题版本中，只要满足以下两个条件：

- 只要使用了 `CommonMiddleware` 中间件 并且 `APPEND_SLASH` 配置项为 `True`

- 请求的 URL 不以 / 结尾，而且项目里接受以 / 结尾的任意 URL（兜底路由，比如所有未匹配的 URL 都到某个默认报错页面）

那么当用户请求一个不存在的 `URL-Path` 时，`Django` 便会自动添加一个斜杠（/）到 URL 末尾，并响应 301 重定向到新的 URL。值得注意的是，`CommonMiddleware` 是很常用的中间件，`APPEND_SLASH` 当不配置时在Django源码（django/conf/global_settings.py）里也是默认开启的，所以该条件成立的机会很大。

在该机制下，利用如下报文：
```
GET //www.test.com HTTP/1.1
Host: 1.2.3.4:8000
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36
Cache-Control: max-age=0


```

便可得到如下响应：
```
HTTP/1.1 301 Moved Permanently
Date: Sun, 30 Nov 2025 09:10:20 GMT
Server: WSGIServer/0.2 CPython/3.7.3
Content-Type: text/html; charset=utf-8
Location: //www.test.com/


```

而响应头里的 `Location: //www.test.com/` 虽然没有标明协议，但对于浏览器来说，会自动继承原来的协议，所以最后等同于 http(s)://www.test.com/，浏览器会自动跳转到该URL。

#### 0x03 问题复现

利用`2.0.7`版本的`Django`，搭建一个简易的Web服务，在其中使用 CommonMiddleware 中间件，并且接受以 / 结尾的任意URL。

比如此时服务监听在 10.67.9.123:8000 上，然后在浏览器上访问 `http://10.67.9.123:8000//www.douban.com`，页面便会自动跳转到豆瓣。

#### 0x04 问题修复

在 Github 的提交里，`Django`官方已对该漏洞做了[修复](https://github.com/django/django/commit/6fffc3c6d420e44f4029d5643f38d00a39b08525)。主要的修复手段是 `Django` 如果判断到 `URL-Path` 里是以两个斜杠 （//） 开头的，便会自动将其替换为一个斜杠（/）。

#### 0x05 小结

任意跳转URL 的漏洞，多用于钓鱼网站，让邮箱等组件认为该 URL 是合法的，导致用户点击后被重定向到钓鱼网站，从而进一步获取用户的敏感信息。







